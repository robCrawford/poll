<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title> poll() test </title>
<script type="text/javascript" src="poll.js"></script>
</head>
<body>

<script type="text/javascript">

(function(window, document, undefined){


/* TEST ASYNC CSS FILE */

	//Create test element for CSS
	var overlayDiv = document.createElement("div");
	overlayDiv.className = "ui-helper-hidden-accessible";
	document.body.appendChild(overlayDiv);

	//Request CSS
	var cssNode = document.createElement('link');
	cssNode.type = 'text/css';
	cssNode.rel = 'stylesheet';
	cssNode.href = "http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/base/jquery-ui.css";
	document.getElementsByTagName('head')[0].appendChild(cssNode);

	//Start polling for CSS result
	var cssTest = poll({
		test: function(){
			return overlayDiv.offsetWidth === 1; //Width set in CSS
		},
		ready: function(){
			console.log( 'CSS loaded' );
		},
		quit: function(){
			console.log( 'Error - CSS did not load' ); 
		},
		frequency: 100, //How often to poll in ms (default: 250)
		timeout: 10000 //ms until quit (default: 30000)
	});


/* TEST GENERIC ASYNC CONDITIONS */

	var testA = poll({
		test: function(){
			return window.conditionA
		},
		ready: function(){
			console.log( "conditionA SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionA FAIL" ); 
		},
		timeout: 100
	});

	var testB = poll({
		test: function(){
			return window.conditionB
		},
		ready: function(){
			console.log( "conditionB SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionB FAIL" ); 
		},
		timeout: 1000
	});

	var testC = poll({
		test: function(){
			return window.conditionC
		},
		ready: function(){
			console.log( "conditionC SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionC FAIL" ); 
		},
		timeout: 2000
	});

	/*
 	  Mock conditions - comment out to fail
	*/
	window.conditionA = 1; //Satisfy testA condition immediately
	setTimeout(function(){window.conditionB = 1}, 500); //Satisfy testB condition after delay

	//setTimeout(function(){testC.ready()}, 500); //Manually call ready() on testC early
	//setTimeout(function(){testC.quit()}, 500); //Manually quit testC early
	setTimeout(function(){window.conditionC = 1}, 1000); //Satisfy testC condition after delay


})(window, document);

</script>

</body>
</html>