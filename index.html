<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title> when() test </title>
<script type="text/javascript" src="when.js"></script>
</head>
<body>

<script type="text/javascript">	
window.onload = function(){

	//Create test element for CSS file
	var overlayDiv = document.createElement("div");
	overlayDiv.className = "ui-helper-hidden-accessible";
	document.body.appendChild(overlayDiv);

	var cssRequest = when({
		load: [
			"http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/base/jquery-ui.css"
		],
		test: function(){
			return overlayDiv.offsetWidth === 1; //Width set in CSS
		},
		ready: function(){
			console.log( 'CSS loaded' );
		},
		quit: function(){
			console.log( 'Error - CSS did not load' ); 
		},
		testInterval: 100, //How often to test in ms
		maxSecs: 20 //Seconds until quit
	});

	/*
	  Mock generic async conditions - comment out to fail
	*/
	window.conditionA = 1; //Satisfy testA condition immediately
	setTimeout(function(){window.conditionB=1},700); //Satisfy testB condition after delay
	setTimeout(function(){window.conditionC=1},1700); //Satisfy testC condition after delay

	//setTimeout(function(){testD.ready()},2000); //Manually call ready() on testD early
	//setTimeout(function(){testD.quit()},3000); //Manually quit testD early
	setTimeout(function(){window.conditionD=1},3700); //Satisfy testD condition after delay

	/*
 	  Create tests
	*/
	var testA = when({
		test: function(){
			return window.conditionA
		},
		ready: function(){
			console.log( "conditionA SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionA FAIL" ); 
		},
		testInterval: 250,
		maxSecs: 0.1
	});

	var testB = when({
		test: function(){
			return window.conditionB
		},
		ready: function(){
			console.log( "conditionB SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionB FAIL" ); 
		},
		testInterval: 250,
		maxSecs: 2
	});

	var testC = when({
		test: function(){
			return window.conditionC
		},
		ready: function(){
			console.log( "conditionC SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionC FAIL" ); 
		},
		testInterval: 250,
		maxSecs: 4
	});

	var testD = when({
		test: function(){
			return window.conditionD
		},
		ready: function(){
			console.log( "conditionD SUCCESS" ); 
		},
		quit: function(){
			console.log( "conditionD FAIL" ); 
		},
		testInterval: 250,
		maxSecs: 6
	});

}
</script>

</body>
</html>